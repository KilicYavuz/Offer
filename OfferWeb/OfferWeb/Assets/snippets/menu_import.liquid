{%- capture nav_ -%}
{%-assign size_handle = 0-%}
{%- for block in section.blocks-%}
{%-assign menu_handle = block.settings.menu_links-%}
{%-assign size_item = linklists[menu_handle].title-%}
{%-assign size_handle = size_handle | plus: size_item.size-%}
{%-assign size_handle = size_handle | plus: block.settings.title.size-%}
{%-endfor-%}
{%-assign items_count = section.blocks.size-%}
{%-if items_count == 0-%}{%-assign items_count = linklists[section.settings.main_linklist].size-%}{%-endif-%}
{%-if preson == 'half-first'-%}
{%-assign _items = items_count | times: 1.0 | divided_by: 2 | ceil-%}
{%-elsif preson == 'half-last'-%}
{%-assign _items = items_count | times: 1.0 | divided_by: 2 | ceil-%}
{%-assign _break = _items-%}
{%-endif-%}

<div style="padding-left: {{section.settings.padding_size}}rem;padding-right: {{section.settings.padding_size}}rem;"> 
<ul class="kt-nav main-menu clone-main-menu" style="margin-left: -{{section.settings.padding_size}}rem;margin-right: -{{section.settings.padding_size}}rem;" data-margin="{{section.settings.padding_size}}"> 
  {%-if section.blocks.size > 0-%}  
  {%-assign link_active = canonical_url |split:shop.url|last-%}
  {%-for block in section.blocks limit: _items offset: _break -%}
    {%-if block.type == 'link'-%}
      {%-assign menu_link = block.settings.button_link-%}
      <li class="menu-item{%if link_active == block.settings.button_link%} active{%endif%} item-{{block.id}}" style="padding-left: {{section.settings.padding_size}}rem;padding-right: {{section.settings.padding_size}}rem" data-block="link">
        <a href="{{menu_link| default: "#"}}">
          <span>{{block.settings.title | default: 'menu item'}}
            {%-if block.settings.label != "" -%}
            <span class="label-menu {{block.settings.label|handleize}}" style="background-color:{{block.settings.color|default: 'transparent'}}">
              {{block.settings.label|upcase}}
            </span>          
            {%-endif-%}
          </span>        
        </a>
      </li>
    {%-elsif block.type == 'special_1'-%}
      {%-assign menu_link = block.settings.button_link-%}
      <li class="menu-item special_link{%if link_active == block.settings.button_link%} active{%endif%} item-{{block.id}}" data-block="special_1">
        <a href="{{menu_link| default: '#'}}">
          <span>{{block.settings.title | default: 'menu item'}}</span>        
        </a>
      </li>
    {%-elsif block.type == 'hot_1'-%}
      {%-assign menu_link = block.settings.button_link-%}
      <li class="menu-item special_link hot_link item-{{block.id}}" data-block="hot_1">
        <div class="d-flex flex-nowrap justify-content-between">
          <span class="percen"></span>
          <a href="{{menu_link| default: '#'}}">
            <div class="menu-item-hot d-flex align-items-center">{{block.settings.title | default: 'menu item'}}</div>        
          </a>
        </div>
      </li>
    {%-elsif block.type == 'standard'-%}
      {%-assign menu_handle = block.settings.menu_links-%}
      <li class="menu-item menu-item-has-children{%if link_active == block.settings.button_link%} active{%endif%} item-{{block.id}}" style="padding-left: {{section.settings.padding_size}}rem;padding-right: {{section.settings.padding_size}}rem" data-block="standard">
        <a href="{{block.settings.button_link| default: "#"}}">
          <span>{{linklists[menu_handle].title | default: 'menu item'}}
            {%-if block.settings.label != "" -%}
            <span class="label-menu {{block.settings.label|handleize}}" style="background-color:{{block.settings.color|default: 'transparent'}}">
              {{block.settings.label|capitalize}}
            </span>
            {%-endif-%}
          </span>        
        </a>
        {%-if linklists[menu_handle].links.size > 0-%}
        <span class="toggle-submenu"></span>
        <ul class="sub-menu">
          {%-for link in linklists[menu_handle].links-%}
          <li class="menu-item{%if link.links.size > 0%} drop_to_right menu-item-has-children site-nav--has-dropdown{%endif%}">
            <a href="{{ link.url }}">
              <span>{{link.title | split: '{' | first }}
                {%-if link.title contains '{'-%}
                {%-assign label = link.title |  split: '{' | last  | split: '}' | first-%}
                <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                {%-endif-%}
              </span>
            </a>
            {%-if link.links.size > 0-%}
            <span class="toggle-submenu"></span>
            <ul class="sub-menu">
              {%-for sub_link in link.links-%}
              <li class="menu-item{%if sub_link.links.size > 0%} drop_to_right menu-item-has-children site-nav--has-dropdown{%endif%}">
                <a href="{{sub_link.url}}">
                  <span>{{sub_link.title | split: '{' | first }}
                    {%-if sub_link.title contains '{'-%}
                    {%- assign label = sub_link.title |  split: '{' | last  | split: '}' | first-%}
                    <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                    {%- endif-%}
                  </span>
                </a>
                {%-if sub_link.links.size > 0-%}
                  <span class="toggle-submenu"></span>
                  <ul class="sub-menu">
                    {%-for sub_sub_link in sub_link.links-%}
                    <li class="menu-item">
                      <a href="{{sub_sub_link.url}}">
                        <span>{{sub_sub_link.title | split: '{' | first }}
                          {%-if sub_sub_link.title contains '{'-%}
                          {%- assign label = sub_sub_link.title |  split: '{' | last  | split: '}' | first-%}
                          <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                          {%- endif-%}
                        </span>
                      </a>
                    </li>
                    {%- endfor-%}
                  </ul>
                {%- endif-%}
              </li>
              {%- endfor-%}
            </ul>
            {%- endif-%}
          </li>
          {%- endfor-%}
        </ul>
        {%- endif-%}
      </li>
    {%-elsif block.type == 'standard_collumn'-%}
      {%-assign menu_handle = block.settings.menu_links-%}
      <li class="menu-item item-megamenu menu-item-has-children{%if link_active == block.settings.button_link%} active{%endif%} item-{{block.id}}" style="padding-left: {{section.settings.padding_size}}rem;padding-right: {{section.settings.padding_size}}rem" data-block="standard_collumn">
        <a href="{{block.settings.button_link| default: "#"}}">
          <span>{{-linklists[menu_handle].title | default: 'menu item'-}}
            {%-if block.settings.label != "" -%}
            <span class="label-menu {{block.settings.label|handleize}}" style="background-color:{{block.settings.color|default: 'transparent'}}">
              {{block.settings.label|capitalize}}
            </span>
            {%-endif-%}
          </span>        
        </a>
        {%- if linklists[menu_handle].links.size > 0-%}
        {%- case linklists[menu_handle].links.size -%}
          {%- when 1 -%}
            {%-assign colitem3 = ''-%}
          {%- when 2 -%}
            {%-assign colitem3 = ' col-sm-6'-%}
          {%- when 3 -%}
            {%-assign colitem3 = ' col-sm-4'-%}
          {%- when 4 -%}
            {%-assign colitem3 = ' col-sm-3'-%}
          {%- when 5 -%}
            {%-assign colitem3 = ' col-sm-20'-%}
          {%- else -%}
            {%-assign colitem3 = ' col-sm-3'-%}
        {%- endcase -%}
        <span class="toggle-submenu"></span>
        <div class="sub-menu" style="width:{{block.settings.menu_links_width|default: '1200px'}}">
          <ul class="row">
            {%-for link in linklists[menu_handle].links-%}
            <li class="menu-item{{colitem3}} site-nav__child-link{%if child_links.size > 0%} menu-item-has-children{%endif%} title_lv1">
              <a href="{{ link.url }}">
                <h3>{{link.title | split: '{' | first | remove:'[title]'}}
                  {%-if link.title contains '{'-%}
                  {%-assign label  = link.title |  split: '{' | last  | split: '}' | first-%}
                  <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                  {%-endif-%}
                </h3>
              </a>
              <ul class="sub-menu">
                {%-if link.links.size > 0-%}
                {%- for sub_link in link.links -%}
                <li class="menu-item site-nav__child-link">
                  <a href="{{sub_link.url}}">
                    <span>{{sub_link.title | split: '{' | first-}}
                      {%-if sub_link.title contains '{'-%}
                      {%-assign label  = sub_link.title |  split: '{' | last  | split: '}' | first-%}
                      <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                      {%-endif-%}
                    </span>
                  </a>
                </li>
                {%-if sub_link.links.size > 0-%}
                {%- for sub_sub_link in sub_link.links -%}
                <li class="menu-item site-nav__child-link">
                  <a href="{{sub_sub_link.url}}">
                    <span>{{sub_sub_link.title | split: '{' | first-}}
                      {%-if sub_sub_link.title contains '{'-%}
                      {%-assign label  = sub_sub_link.title |  split: '{' | last  | split: '}' | first-%}
                      <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                      {%-endif-%}
                    </span>
                  </a>
                </li>
                {%-endfor-%}
                {%-endif-%}
                {%-endfor-%}
                {%-endif-%}
              </ul>
            </li>
            {%-endfor-%}
          </ul>
        </div>
        {%-endif-%}
      </li>
    {%-elsif block.type == 'multi_collumn'-%}
      {%- assign menu_handle = block.settings.menu_links-%}
      <li class="menu-item item-megamenu menu-item-has-children{%if link_active == block.settings.button_link%} active{%endif%} item-{{block.id}}" style="padding-left: {{section.settings.padding_size}}rem;padding-right: {{section.settings.padding_size}}rem" data-block="multi_collumn">
        <a href="{{block.settings.button_link| default: "#"}}">
          <span>{{linklists[menu_handle].title | default: 'menu item'}}
            {%-if block.settings.label != "" -%}
            <span class="label-menu {{block.settings.label|handleize}}" style="background-color:{{block.settings.color|default: 'transparent'}}">
              {{block.settings.label|capitalize}}
            </span>
            {%-endif-%}
          </span>        
        </a>
        {%-if linklists[menu_handle].links.size > 0-%}
        <span class="toggle-submenu"></span>
        <div style="width:{{block.settings.menu_links_width|default: '1200px'}};background-color: {{block.settings.bg_color|default: 'transparent'}};" class="sub-menu{%if block.settings.bg_image%} lazyload{%endif%}" {%if block.settings.bg_image%} data-bgset="{%- render 'bgset', image: block.settings.bg_image -%}" data-sizes="auto" style="background-image: url('{{ block.settings.bg_image | img_url: '300x300' }});"{%endif%}>
          <div class="row">
            {%- assign link_handle = linklists[menu_handle].links | map: 'handle' | join: ' '-%}
            {%-if link_handle contains 'breakcol'-%}
            {%- assign count = 0-%}
            {%- assign per = block.settings.menu_links_per_col | plus: 0-%}
            {%- for link in linklists[menu_handle].links-%}
            {%- if count == 0-%}
            <div class="{%if per != 1%}col-md-{%if per == 2%}6{%elsif per == 3%}4{%elsif per >= 4%}3{%endif%} {%endif%}col-sm-12">
              <div class="mega-custom-menu menu-col">
                <ul>
                  {%- endif -%}
                  {%- unless link.handle == 'breakcol'-%}
                    {%-if link.title contains '[title]'-%}
                      <li class="menu-item{%if link.title contains 'CSS_'%} {{link.title | split: 'CSS_' | last | strip}}{%endif%} title_lv1">
                        {%- capture hoverBanner -%}
                        {%- if link.type == 'collection_link' and collections[link.object.handle].metafields.meta.banner -%}
                        data-hover-banner="{{collections[link.object.handle].metafields.meta.banner|replace:'"',"'"}}"
                        {%- elsif link.type == 'collection_link' and link.object.image-%} data-hover-image="{{link.object.image | img_url: 'master' }}"
                        {%- endif -%}
                        {%- endcapture -%}
                        <a href="{{ link.url }}" class="{%if hoverBanner != blank%}bgChange{%endif%}" {{hoverBanner}}>
                          <h3>
                            <span>{{link.title | split: '{' | first | remove:'[title]' | split: 'CSS_' | first | strip}}</span>
                            {%- if link.title contains '{'-%}
                            {%- assign label  = link.title |  split: '{' | last  | split: '}' | first | remove:'[title]'-%}
                            <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                            {%- endif -%}
                          </h3>
                        </a>
                      </li>              
                      {%-assign child_links = linklists[link.handle].links-%}
                      {%- if child_links.size > 0-%}
                        {%-for child_link in child_links-%}
                          {%-if child_link.handle == 'breakline'-%}
                            <li style="height: 41px;display:block;width: 100%;"></li>
                          {%-else-%}
                            <li class="menu-item">
                              <a href="{{child_link.url}}"
                                 {%if child_link.type == 'collection_link' and collections[child_link.object.handle].metafields.meta.banner%}
                                  data-hover-banner="{{collections[child_link.object.handle].metafields.meta.banner|replace:'"',"'"}}" class="bgChange"
                                 {%elsif child_link.type == 'collection_link' and child_link.object.image%} data-hover-image="{{child_link.object.image | img_url: 'master' }}" class="bgChange"
                                 {%endif%}>
                                <span>{{child_link.title | split: '{' | first }}
                                  {%- if child_link.title contains '{'-%}
                                  {%- assign label  = child_link.title |  split: '{' | last  | split: '}' | first-%}
                                  <span class="label-menu {{label | handleize }}{%if link.title contains 'CSS_'%} {{link.title | split: 'CSS_' | last | strip}}{%endif%}">{{label|escape }}</span>
                                  {%- endif -%}
                                </span>
                              </a>
                            </li>
                          {%-endif-%}
                        {%-endfor-%}
                      {%- endif-%}
                    {%-else-%}                
                      {%-if link.handle == 'breakline'-%}
                        <li style="height: 41px;display:block;width: 100%;"></li>
                      {%-else-%}
                        <li class="menu-item">
                          <a href="{{link.url}}">
                            <span>{{link.title | split: '{' | first }}
                              {%- if link.title contains '{'-%}
                              {%- assign label  = link.title |  split: '{' | last  | split: '}' | first-%}
                              <span class="label-menu {{label | handleize }}{%if link.title contains 'CSS_'%} {{link.title | split: 'CSS_' | last | strip}}{%endif%}">{{label|escape }}</span> 
                              {%- endif -%}
                            </span>
                          </a>
                        </li>
                      {%- endif-%}
                    {%- endif-%}
                  {%-endunless-%}
                  {%-if forloop.last or link.handle == 'breakcol'-%}
                </ul>
              </div>
            </div>
            {%- assign count = 0-%}
            {%- else-%}
            {%- assign count = count | plus: 1-%}
            {%- endif-%}
            {%- endfor-%}
            {%-else-%}
            
            {%- assign count = 0-%}
            {%- for link in linklists[menu_handle].links-%}
            {%- if block.settings.menu_links_per_col != '1'-%}
            {%- assign size = linklists[menu_handle].links.size  | plus: 0-%}
            {%- assign per = block.settings.menu_links_per_col | plus: 0-%}
            {%- assign size_per = size | divided_by: per | ceil-%}
            {%- assign breakline = size_per | minus: 1-%}
            {%- endif-%}
            {%-assign child_links = linklists[link.handle].links-%}
            
            {%-if count == 0 -%}
            <div class="{%if per != 1%}col-md-{%if per == 2%}6{%elsif per == 3%}4{%elsif per >= 4%}3{%endif%} {%endif%}col-sm-12">
              <div class="mega-custom-menu menu-col">
                <ul>
                  {%- endif-%}
                  {%-if link.title contains '[title]'-%}
                  <li class="menu-item{%if link.title contains 'CSS_'%} {{link.title | split: 'CSS_' | last | strip}}{%endif%} title_lv1">
                    <a href="{{ link.url }}">
                      <h3>
                        <span>{{link.title | split: '{' | first | remove:'[title]' | split: 'CSS_' | first | strip}}</span>
                        {%- if link.title contains '{'-%}
                        {%- assign label  = link.title |  split: '{' | last  | split: '}' | first | remove:'[title]'-%}
                        <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                        {%- endif -%}
                      </h3>
                    </a>
                  </li>
                  {%-else-%}
                  <li class="menu-item">
                    <a href="{{ link.url }}">
                      <span>{{link.title | split: '{' | first }}
                        {%- if link.title contains '{'-%}
                        {%- assign label  = link.title |  split: '{' | last  | split: '}' | first-%}
                        <span class="label-menu  {{label | handleize }}">{{label|escape }}</span> 
                        {%- endif -%}
                      </span>
                    </a>
                  </li>
                  {%-endif-%}
                  {%- if child_links.size > 0-%}
                  {%-for child_link in child_links-%}
                  <li class="menu-item">
                    <a href="{{child_link.url}}">
                      <span>{{child_link.title | split: '{' | first }}
                        {%- if child_link.title contains '{'-%}
                        {%- assign label  = child_link.title |  split: '{' | last  | split: '}' | first-%}
                        <span class="label-menu  {{label | handleize }}">{{label|escape }}</span> 
                        {%- endif -%}
                      </span>
                    </a>
                  </li>
                  {%-endfor-%}
                  {%- endif-%}
                  {%-if forloop.last or count == breakline-%}
                </ul>
              </div>
            </div>
            {%-assign count = 0-%}
            {%-else-%}
            {%-assign count = count | plus: 1-%}
            {%-endif-%}
            {%- endfor-%}
            {%- endif-%}
          </div>
        </div>
        {%- endif-%}
      </li>
    {%-elsif block.type == 'filter'-%}
      {%- assign coll_handle = block.settings.collection-%}
      {%- assign menu_handle = block.settings.menu_links-%}
      <li class="menu-item item-megamenu menu-item-has-children{%if link_active == collections[coll_handle].url%} active{%endif%} item-{{block.id}}" style="padding-left: {{section.settings.padding_size}}rem;padding-right: {{section.settings.padding_size}}rem" data-block="filter">
        {%- assign currTags = '' -%}
        {%- if current_tags and collection.id == collections[coll_handle].id -%}
          {%- for tag in current_tags -%}
            {%- assign tag_ =  tag | handleize -%}
            {%- assign currTags = currTags | append: tag_ -%}
            {%- unless forloop.last -%}
            {%- assign currTags = currTags | append: '+' -%}
            {%- endunless -%}
          {%- endfor -%}
          {% assign currTags = currTags | prepend: '/' %}
        {%- endif -%}
        <a href="{{collections[coll_handle].url| default: '/collections/all'}}">
          <span>{{block.settings.title | default: collections[coll_handle].title}}
            {%-if block.settings.label != "" -%}
            <span class="label-menu {{block.settings.label|handleize}}" style="background-color:{{block.settings.color|default: 'transparent'}}">
              {{block.settings.label|capitalize}}
            </span>
            {%-endif-%}
          </span>        
        </a>
        {%- if linklists[menu_handle].links.size > 0 -%}
        <div class="cat_drop_header d-none">
          <div class="widget widget_product_categories col-12">
            <div class="layered_subtitle_heading">
              <span class="layered_subtitle">{{ 'blogs.sidebar.categories' | t }}<span></span></span>
              <span class="ico"><i class="fkt-angle-down" aria-hidden="true"></i></span>
            </div>
            <ul class="product-categories kt_filterGroupItem_ul">
              {%- for line_collection in linklists[menu_handle].links -%}
              {%- if line_collection.type == 'collection_link' -%}
              <li class="{% if collection.handle == line_collection.object.handle %}current-cat showAny{% endif %}"><a data-scroll-top="" data-pjax-filter="" href="{{line_collection.object.url}}">{{line_collection.title}} <span class="count rtl_fix" data-ogr-title="({{line_collection.object.all_products_count}})">({{line_collection.object.all_products_count}})</span></a>
              </li>
              {%- endif -%}
              {%- endfor -%}
            </ul>
          </div>
        </div>
        {%- endif -%}
        {%-if collections[coll_handle].all_tags.size > 0 or block.settings.use_promo_html-%}
        {%- assign promo_width = block.settings.promo_width | plus: 0-%}
        {%- assign filter_width = 12 | minus: promo_width -%}
        <span class="toggle-submenu"></span>
        <div style="width:{{block.settings.menu_links_width|default: '1200px'}}" class="sub-menu megaMaxscroll">
          <div class="row">
            {%-if collections[coll_handle].all_tags.size > 0 %}
            <div class="col-{{filter_width}}">
              <div class="kt_layerfilterGroups">        
                <div class="spinner-box">
                  <div class="pulse-container">  
                    <div class="pulse-bubble pulse-bubble-1"></div><div class="pulse-bubble pulse-bubble-2"></div><div class="pulse-bubble pulse-bubble-3"></div>
                  </div>
                </div>
              </div>
            </div>
            {%- endif -%}
            {%- if block.settings.use_promo_html -%}
            <div class="col-{{promo_width}}">
              {%- if block.settings.page_promo_html != blank -%}
                <div class="lazyload" data-include="{{pages[block.settings.page_promo_html].url}}?q=ly_none"></div>
              {%-else-%}
                {{block.settings.textarea_promo_html|html}}
              {%- endif-%}
            </div>
            {%- endif -%}
          </div>
        </div>
        {%- endif-%}
      </li>
    {%-elsif block.type == 'per_column'-%}
      {%- assign menu_handle = block.settings.menu_links-%}
      <li class="menu-item item-megamenu menu-item-has-children{%if link_active == block.settings.button_link%} active{%endif%} item-{{block.id}}" style="padding-left: {{section.settings.padding_size}}rem;padding-right: {{section.settings.padding_size}}rem" data-block="per_column">
        <a href="{{block.settings.button_link| default: '#'}}">
          <span>{{linklists[menu_handle].title | default: 'menu item'}}
            {%-if block.settings.label != "" -%}
            <span class="label-menu {{block.settings.label|handleize}}" style="background-color:{{block.settings.color|default: 'transparent'}}">
              {{block.settings.label|capitalize}}
            </span>
            {%-endif-%}
          </span>        
        </a>
        {%-if linklists[menu_handle].links.size > 0-%}
        <span class="toggle-submenu"></span>
        <div style="width:{{block.settings.menu_links_width|default: '1200px'}}" class="sub-menu">
          <div class="row">
            {%- assign count = 0-%}
            {%- for link in linklists[menu_handle].links-%}
            {%- if block.settings.menu_links_per_col != '1'-%}
            {%- assign size = linklists[menu_handle].links.size  | plus: 0-%}
            {%- assign per = block.settings.menu_links_per_col | plus: 0-%}
            {%- assign size_per = size | divided_by: per | ceil-%}
            {%- assign breakline = size_per | minus: 1-%}
            {%- endif-%}
            {%-if count == 0 -%}
            <div class="{%if per != 1%}col-md-{%if per == 2%}6{%elsif per == 3%}4{%elsif per >= 4%}3{%endif%} {%endif%}col-sm-12">
              <div class="mega-custom-menu menu-col">
                <ul>
                  {%- endif-%}
                  <li class="menu-item">
                    <a href="{{link.url}}">
                      <span>{{link.title | split: '{' | first }}
                        {%- if link.title contains '{' -%}
                        {%- assign label  = link.title |  split: '{' | last  | split: '}' | first -%}
                        <span class="label-menu {{label | handleize }}{%if link.title contains 'CSS_'%} {{link.title | split: 'CSS_' | last | strip}}{%endif%}">{{label|escape }}</span> 
                        {%- endif-%}
                      </span>
                    </a>
                  </li>
                  {%-if forloop.last or count == breakline-%}
                </ul>
              </div>
            </div>
            {%-assign count = 0-%}
            {%-else-%}
            {%-assign count = count | plus: 1-%}
            {%-endif-%}
            {%-endfor-%}
          </div>
        </div>
        {%- endif-%}
      </li>
    {%-elsif block.type == 'promo'-%}
      {%-assign menu_handle = block.settings.menu_links-%}
      <li class="menu-item item-megamenu menu-item-has-children{%if link_active == block.settings.button_link%} active{%endif%} item-{{block.id}}" style="padding-left: {{section.settings.padding_size}}rem;padding-right: {{section.settings.padding_size}}rem" data-block="promo">
        <a href="{{block.settings.button_link| default: "#"}}">
          <span>{{block.settings.name_item | default: linklists[menu_handle].title}}
            {%-if block.settings.label != "" -%}
            <span class="label-menu {{block.settings.label|handleize}}" style="background-color:{{block.settings.color|default: 'transparent'}}">
              {{block.settings.label|capitalize}}
            </span>
            {%-endif-%}
          </span>        
        </a>
        <span class="toggle-submenu"></span>
        <div style="width:{{block.settings.menu_links_width|default: '1200px'}};background-color: {{block.settings.bg_color|default: 'transparent'}};{%if block.settings.use_promo_html == false and block.settings.promo_link == blank and block.settings.promo_image%};background-repeat: no-repeat;background-size: contain;background-position: right;{%-endif-%}" class="sub-menu{%if block.settings.use_promo_html and block.settings.page_promo_html != blank%} megaMaxscroll{%endif%}{%if block.settings.use_promo_html == false and block.settings.promo_link == blank and block.settings.promo_image%} lazyload{%endif%}"{%if block.settings.use_promo_html == false and block.settings.promo_link == blank and block.settings.promo_image%} data-bgset="{%- render 'bgset', image: block.settings.promo_image, prioritize: 'height' -%}" data-sizes="cover"{%endif%}>
          {%- assign promo_width = block.settings.promo_width | plus: 0-%}
          {%- assign linklists_width = 12 | minus: promo_width-%}
          {%- if linklists_width == 0 -%}{%- assign linklists_width = 12 -%}{%- endif -%}
          <div class="row no-gutters">
            {%-if linklists[menu_handle].links.size > 0-%}
            <div class="col-md-{{linklists_width}} col-sm-12">
              <div class="menu-col w-100">
                <div class="row">
                  {%- assign link_handle = linklists[menu_handle].links | map: 'handle' | join: ' '-%}
                  {%- assign per = block.settings.menu_links_per_col | plus: 0-%}
                  {%-if link_handle contains 'breakcol'-%}
                    {%- assign count = 0-%}
                    {%- for link in linklists[menu_handle].links-%}
                    {%-if count == 0-%}
                    <div class="col-12 {%if per != 1%}col-md-{%if per == 2%}6{%elsif per == 3%}4{%elsif per >= 4%}3{%endif%}{%endif%}">
                      <div class="mega-custom-menu">
                        <ul>
                          {%-endif-%}
                          {%- unless link.handle == 'breakcol'-%}
                          <li class="menu-item{%if link.title contains '[title]'%} title_lv1{%endif%}">
                            <a href="{{link.url}}">
                              <span>{{link.title | split: '{' | first | remove:'[title]'}}
                                {%- if link.title contains '{'-%}
                                {%- assign label  = link.title |  split: '{' | last  | split: '}' | first-%}
                                <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                                {%- endif -%}
                              </span>
                            </a>
                          </li>
                            {%- if link.links.size > 0 -%}
                              {%- for sub_link in link.links -%}
                              <li class="menu-item{%if link.active%}active{%endif%}">
                                <a href="{{ sub_link.url }}">
                                  <span>
                                    {{sub_link.title | split: '{' | first }}
                                    {%-if sub_link.title contains '{'-%}
                                    {%-assign label = sub_link.title |  split: '{' | last  | split: '}' | first-%}
                                    <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                                    {%-endif-%}
                                  </span>
                                  {%if sub_link.links.size > 0%}<span class="mmenu-btn"></span>{%endif%}
                                </a>
                              </li>
                                {%if sub_link.links.size > 0%}
                                  {% for sub_sub_link in sub_link.links %}
                                  <li class="menu-item">
                                    <a href="{{ sub_sub_link.url }}">
                                      {{sub_sub_link.title | split: '{' | first }}
                                      {%-if sub_sub_link.title contains '{'-%}
                                      {%-assign label = sub_sub_link.title |  split: '{' | last  | split: '}' | first-%}
                                      <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                                      {%-endif-%}
                                    </a>
                                  </li>                    
                                  {%- endfor -%}
                                {%endif%}
                              {%- endfor -%}
                            {%- endif -%}
                          {%-endunless-%}
                          {%- if forloop.last or link.handle == 'breakcol'-%}
                        </ul>
                      </div>
                    </div>
                    {%- assign count = 0-%}
                    {%- else-%}
                    {%- assign count = count | plus: 1-%}
                    {%- endif-%}
                    {%- endfor-%}
                  {%-elsif per >= 1 -%}
                    {%- assign count = 0-%}
                    {%- for link in linklists[menu_handle].links-%}
                    {%- if block.settings.menu_links_per_col != '1'-%}
                    {%- assign size = linklists[menu_handle].links.size  | plus: 0-%}
                    {%- assign per = block.settings.menu_links_per_col | plus: 0-%}
                    {%- assign size_per = size | divided_by: per | ceil-%}
                    {%- assign breakline = size_per-%}
                    {%- endif-%}
                    {%-if count == 0 -%}
                    <div class="col-12 {%if per != 1%}col-md-{%if per == 2%}6{%elsif per == 3%}4{%elsif per >= 4%}3{%endif%}{%endif%}">
                      <div class="mega-custom-menu">
                        <ul>
                          {%- endif-%}
                          <li class="menu-item{%if link.title contains '[title]'%} title_lv1{%endif%}">
                            <a href="{{link.url}}">
                              <span>{{link.title | split: '{' | first | remove:'[title]'}}
                                {%- if link.title contains '{'-%}
                                {%- assign label  = link.title |  split: '{' | last  | split: '}' | first-%}
                                <span class="label-menu  {{label | handleize }}">{{label|escape }}</span> 
                                {%- endif -%}
                              </span>
                            </a>
                          </li>
                            {%- if link.links.size > 0 -%}
                              {%- for sub_link in link.links -%}
                              <li class="menu-item{%if link.active%}active{%endif%}">
                                <a href="{{ sub_link.url }}">
                                  <span>
                                    {{sub_link.title | split: '{' | first }}
                                    {%-if sub_link.title contains '{'-%}
                                    {%-assign label = sub_link.title |  split: '{' | last  | split: '}' | first-%}
                                    <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                                    {%-endif-%}
                                  </span>
                                  {%if sub_link.links.size > 0%}<span class="mmenu-btn"></span>{%endif%}
                                </a>
                              </li>
                                {%if sub_link.links.size > 0%}
                                  {% for sub_sub_link in sub_link.links %}
                                  <li class="menu-item">
                                    <a href="{{ sub_sub_link.url }}">
                                      {{sub_sub_link.title | split: '{' | first }}
                                      {%-if sub_sub_link.title contains '{'-%}
                                      {%-assign label = sub_sub_link.title |  split: '{' | last  | split: '}' | first-%}
                                      <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                                      {%-endif-%}
                                    </a>
                                  </li>                    
                                  {%- endfor -%}
                                {%endif%}
                              {%- endfor -%}
                            {%- endif -%}
                          {%-if forloop.last or count == breakline-%}
                        </ul>
                      </div>
                    </div>
                    {%-assign count = 0-%}
                    {%-else-%}
                    {%-assign count = count | plus: 1-%}
                    {%-endif-%}
                    {%-endfor-%}
                  {%-endif-%}
                </div>
              </div>
            </div>
            {%- endif-%}
            <div class="col-md-{{promo_width}} col-sm-12">
              {%-if block.settings.use_promo_html == false-%}
                {%- if block.settings.promo_link != blank-%}
                  <a class="d-block" href="{{block.settings.promo_link}}">
                    <img class="lazyload" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAQAICRAEAOw==" data-src="{{block.settings.promo_image| img_url: 'master'}}" alt="{{block.settings.promo_image.alt}}">
                  </a>
                {%- endif-%}
              {%- else-%}
                {%- if block.settings.page_promo_html != blank and pages[block.settings.page_promo_html].title != empty-%}
                  <div class="lazyload" data-include="{{pages[block.settings.page_promo_html].url}}?q=ly_none"></div>
                {%-else-%}
                  {{block.settings.textarea_promo_html|html}}
                {%- endif-%}
              {%-endif-%}
            </div>
          </div>
        </div>
      </li>
    {%- endif-%}
  {%- endfor-%}
  {%- else-%}
  {%-assign main_linklist = section.settings.main_linklist | default: 'main-menu' -%}
    {%-for link in linklists[main_linklist].links-%}
      {%-assign menu_handle = link.handle-%}
      <li class="menu-item site-nav__link--main{%if linklists[menu_handle].links.size > 0%} menu-item-has-children site-nav--has-dropdown{%endif%}" style="padding-left: {{section.settings.padding_size}}rem;padding-right: {{section.settings.padding_size}}rem">
        <a href="{{link.url}}">
          <span>{{link.title | split: '{' | first | remove:'[title]' | split: 'CSS_' | first | strip}}
            {%- if link.title contains '{'-%}
            {%- assign label  = link.title |  split: '{' | last  | split: '}' | first | remove:'[title]'-%}
            <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
            {%- endif -%}
          </span>          
        </a>
        {%-if linklists[menu_handle].links.size > 0-%}
        <span class="toggle-submenu"></span>
        <ul class="sub-menu">
          {%-for link_ in linklists[menu_handle].links-%}
          {%-assign child_links = linklists[link_.handle].links-%} 
          <li class="menu-item{%if child_links.size > 0%} drop_to_right menu-item-has-children site-nav--has-dropdown{%endif%}">
            <a href="{{ link_.url }}">
              <span>{{ link_.title | split: '{' | first }}
                {%-if link_.title contains '{'-%}
                {%-assign label = link_.title | split: '{' | last | split: '}' | first-%}
                <span class="label-menu {{label | handleize }}">{{label|escape }}</span> 
                {%-endif -%}
              </span>
            </a>
            {%-if child_links.size > 0-%}
            <span class="toggle-submenu"></span>
            <ul class="sub-menu">
              {%-for child_link in child_links-%}
              <li class="menu-item">
                <a href="{{child_link.url}}">
                  <span>{{ child_link.title | split: '{' | first }}
                    {%-if child_link.title contains '{'-%}
                    {%- assign label  = child_link.title | split: '{' | last | split: '}' | first-%}
                    <span class="label-menu  {{label | handleize }}">{{label|escape }}</span> 
                    {%- endif-%}
                  </span>
                </a>
              </li>
              {%-endfor-%}
            </ul>
            {%-endif-%}
          </li>
          {%-endfor-%}
        </ul>
        {%-endif-%}
      </li>
    {%-endfor-%}
  {%- endif-%}
</ul>
</div>
{%- endcapture -%}
{{nav_|strip_newlines|replace:'  ',' '| remove: '  '}}